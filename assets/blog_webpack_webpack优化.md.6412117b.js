import{_ as s,c as a,o as l,d as n}from"./chunks/framework.0637349f.js";const A=JSON.parse('{"title":"webpack优化","description":"记录webpack相关知识","frontmatter":{"title":"webpack优化","date":"2020-09-09T00:00:00.000Z","description":"记录webpack相关知识","disabled":true,"readMins":8,"tags":["Webpack"]},"headers":[],"relativePath":"blog/webpack/webpack优化.md","filePath":"blog/webpack/webpack优化.md"}'),p={name:"blog/webpack/webpack优化.md"},e=n(`<h2 id="webpack-构建流程" tabindex="-1">webpack 构建流程 <a class="header-anchor" href="#webpack-构建流程" aria-label="Permalink to &quot;webpack 构建流程&quot;">​</a></h2><ul><li>初始化参数：从配置文件、Shell 命令中读取合并相关参数</li><li>初始化编译：使用上述的参数来实例化一个 Compiler 对象，注册插件并传入实例中</li><li>生成依赖图：从 entry 出发，调用所有配置的 loader 来对模块进行翻译，递归解析所有依赖，使用 AST 引擎生成抽象语法树(AST)</li><li>seal 输出资源：根据入口和模块的依赖关系，组装成一个包含多个模块的 Chunk，再把每个 Chunk 转换成一个单独的文件加入到输出列表，这是能修改输出内容的最后机会</li><li>emit 输出完成：确定输出文件路径和文件名，直接写入文件系统</li></ul><h2 id="webpack-优化方案" tabindex="-1">webpack 优化方案 <a class="header-anchor" href="#webpack-优化方案" aria-label="Permalink to &quot;webpack 优化方案&quot;">​</a></h2><h3 id="查看-webpack-性能问题" tabindex="-1">查看 webpack 性能问题 <a class="header-anchor" href="#查看-webpack-性能问题" aria-label="Permalink to &quot;查看 webpack 性能问题&quot;">​</a></h3><ul><li>使用<code>speed-measure-webpack-plugin</code>测量打包速度</li><li>使用<code>webpack-bundle-analyzer</code>进行体积分析</li></ul><h3 id="优化-loader-配置" tabindex="-1">优化 Loader 配置 <a class="header-anchor" href="#优化-loader-配置" aria-label="Permalink to &quot;优化 Loader 配置&quot;">​</a></h3><ul><li>优化搜索时间</li><li>缩小文件搜索范围</li><li>减少不必要的编译工作</li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">module</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">rules</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 如果项目源码中只有.js文件，就不要写成/\\jsx?$/，以提升正则表达式的性能</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">test</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">\\.</span><span style="color:#C3E88D;">js</span><span style="color:#89DDFF;font-style:italic;">$</span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// babel-loader支持缓存转换出的结果，通过cacheDirectory选项开启</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">use</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">babel-loader?cacheDirectory</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 只对src目录中的文件采用 babel-loader</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">include</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">(__dirname</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 使用resolve.alias把原导入路径映射成一个新的导入路径，减少耗时的递归解析操作</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">alias</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">react</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">(__dirname</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./node_modules/react/dist/react.min.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 让 Webpack 忽略对部分没采用模块化的文件的递归解析处理</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">noParse</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/jquery|lodash/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span></code></pre></div><h3 id="dll-plugin-or-externals" tabindex="-1">DLL Plugin Or Externals <a class="header-anchor" href="#dll-plugin-or-externals" aria-label="Permalink to &quot;DLL Plugin Or Externals&quot;">​</a></h3><p>目的是在处理第三方库的时候尽量少的打包</p><ul><li>Externals 的使用方式是直接配置 Externals 选项，当 webpack 打包时，遇到所配置的 Externals，直接跳过</li><li>DllPlugin 和 DllReferencePlugin <ul><li>新建一个 webpack 配置文件，用来构建第三方包</li><li>配置 DllPlugin，传入 context、name 和 path，配置好打包的 output，运行一次打包</li><li>在你的业务代码的配置文件中，配置 DllReferencePlugin，context、name、manifest 等</li></ul></li></ul><h3 id="多进程" tabindex="-1">多进程 <a class="header-anchor" href="#多进程" aria-label="Permalink to &quot;多进程&quot;">​</a></h3><p>一些开销特别大的 loader 可以放进一个单独的线程中，但是会有一些限制，比如无法使用 loader 的 api，而且也拿不到 webpack 的配置项</p><ul><li>thread-loader(推荐使用)</li><li>happypack(不怎么维护了)</li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">module</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">rules</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">test</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">\\.</span><span style="color:#C3E88D;">js</span><span style="color:#89DDFF;font-style:italic;">$</span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">include</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">use</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">thread-loader</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;">// your expensive loader (e.g babel-loader)</span></span>
<span class="line"><span style="color:#A6ACCD;">        ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span></code></pre></div><h3 id="合理利用缓存" tabindex="-1">合理利用缓存 <a class="header-anchor" href="#合理利用缓存" aria-label="Permalink to &quot;合理利用缓存&quot;">​</a></h3><p>缓存可以解决除第一次打包之外的速度，效果比较明显的就是 hard-source-webpack-plugin</p><h3 id="code-splitting-代码分割" tabindex="-1">Code Splitting(代码分割) <a class="header-anchor" href="#code-splitting-代码分割" aria-label="Permalink to &quot;Code Splitting(代码分割)&quot;">​</a></h3><ul><li>配置多 entry 页面</li><li>使用 SplitChunksPlugin 进行重复数据删除和提取</li><li>使用 Dynamic Import 指定模块拆分，并且可以结合 preload、prefetch 做更多用户体验上的优化</li></ul><h3 id="noparse" tabindex="-1">noParse <a class="header-anchor" href="#noparse" aria-label="Permalink to &quot;noParse&quot;">​</a></h3><p>对于某些没有第三方引用的包，可以使用 module.noParse 来提升构建速度</p><h3 id="ignoreplugin" tabindex="-1">IgnorePlugin <a class="header-anchor" href="#ignoreplugin" aria-label="Permalink to &quot;IgnorePlugin&quot;">​</a></h3><p>比如忽略 moment 的本地化内容</p><ul><li>requestRegExp 匹配(test)资源请求路径的正则表达式。</li><li>contextRegExp （可选）匹配(test)资源上下文（目录）的正则表达式。</li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> webpack</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">IgnorePlugin</span><span style="color:#A6ACCD;">(requestRegExp</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> [contextRegExp])</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 忽略 moment 的本地化内容</span></span>
<span class="line"><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> webpack</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">IgnorePlugin</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;font-style:italic;">^</span><span style="color:#A6ACCD;">\\.\\/</span><span style="color:#C3E88D;">locale</span><span style="color:#89DDFF;font-style:italic;">$</span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">,</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">moment</span><span style="color:#89DDFF;font-style:italic;">$</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div>`,25),o=[e];function t(c,r,D,i,y,F){return l(),a("div",null,o)}const d=s(p,[["render",t]]);export{A as __pageData,d as default};
